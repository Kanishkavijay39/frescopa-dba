<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<script type="speculationrules">
    {
        "prerender": [{
            "where": {
                "href_matches": "/*"
            },
            "eagerness": "moderate"
        }]
    }
</script>
<script type="importmap">
    {
        "imports": {
            "@dropins/tools/": "/scripts/__dropins__/tools/",
            "@dropins/storefront-cart/": "/scripts/__dropins__/storefront-cart/",
            "@dropins/storefront-checkout/": "/scripts/__dropins__/storefront-checkout/",
            "@dropins/storefront-pdp/": "/scripts/__dropins__/storefront-pdp/",
            "@dropins/storefront-order-confirmation/": "/scripts/__dropins__/storefront-order-confirmation/",
            "@dropins/storefront-account/": "/scripts/__dropins__/storefront-account/",
            "@dropins/storefront-order/": "/scripts/__dropins__/storefront-order/",
            "@dropins/storefront-auth/": "/scripts/__dropins__/storefront-auth/"
        }
    }
</script>

<link rel="stylesheet" href="/styles/styles.css" />
<link rel="stylesheet" href="/styles/lazy-styles.css" />
<link rel="stylesheet" href="/styles/fonts.css" />
<link rel="stylesheet" href="/styles/article.css" />
<link rel="stylesheet" href="/styles/heavy-performance-issues.css" />

<script src="/scripts/aem.js"></script>
<script src="/scripts/scripts.js"></script>
<script src="/scripts/configs.js"></script>
<script src="/scripts/commerce.js"></script>
<script>
  // Heavy synchronous JavaScript that blocks interactions
  function heavyBlockingOperation() {
    const startTime = Date.now();
    const largeArray = new Array(500000).fill(0);
    
    // CPU-intensive operations
    for (let i = 0; i < largeArray.length; i++) {
      largeArray[i] = Math.random() * Math.sin(i) * Math.cos(i) * Math.tan(i);
    }
    
    // More blocking operations
    const result = largeArray.map(x => x * 2).filter(x => x > 0.5).reduce((a, b) => a + b, 0);
    
    // Force layout thrashing
    for (let i = 0; i < 100; i++) {
      document.body.style.marginTop = Math.random() + 'px';
      document.body.offsetHeight; // Force reflow
    }
    
    console.log('Heavy operation completed in', Date.now() - startTime, 'ms');
    return result;
  }
  
  // Run heavy operations on page load
  document.addEventListener('DOMContentLoaded', function() {
    heavyBlockingOperation();
    
    // Set up interval for continuous blocking
    setInterval(heavyBlockingOperation, 2000);
  });
  
  // Block on user interactions
  document.addEventListener('click', function(e) {
    const blockingStart = Date.now();
    while (Date.now() - blockingStart < 200) {
      Math.random() * Math.random();
    }
  });
</script>

<link rel="preload" href="/placeholders.json" as="fetch" crossorigin="anonymous" />
<link rel="modulepreload" href="/scripts/initializers/index.js" />
<link rel="modulepreload" href="/scripts/initializers/auth.js" />
<link rel="modulepreload" href="/scripts/initializers/cart.js" />
<link rel="modulepreload" href="/scripts/__dropins__/storefront-auth/api.js" />
<link rel="modulepreload" href="/scripts/__dropins__/tools/event-bus.js" />
<link rel="modulepreload" href="/scripts/__dropins__/tools/fetch-graphql.js" />
<link rel="modulepreload" href="/scripts/__dropins__/tools/initializer.js" />
<link rel="modulepreload" href="/scripts/__dropins__/tools/preact.js" />
<link rel="modulepreload" href="/scripts/__dropins__/tools/preact-compat.js" />
<link rel="modulepreload" href="/scripts/__dropins__/tools/preact-hooks.js" />
<link rel="modulepreload" href="/scripts/__dropins__/tools/components.js" />
